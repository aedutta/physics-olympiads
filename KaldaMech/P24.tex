\begin{solution}{hard}
Let the acceleration of small block on top be $a_1$, the small block on the side be $a_2$, and the big block be $a_3$. We create three $F=ma$ equations
\begin{align}
mg-T=ma_2\\
T=ma_1\\
-T=Ma_3
\end{align}If the block on the side moves a small distance $d_1$, then the block on top will move a small distance $d_2$ to the right which makes the whole big block move a distance $d_3$ to the left. Therefore as a result,
\[
d_2=d_1+d_3
\]and the acceleration
\[
a_2=a_1+a_3
\]From equation (1) we have
\begin{align*}
mg-T=m(a_1+a_3)\\
mg-T=T+ma_3\\
mg-ma_3=2Ma_3\\
mg=(2M+m)a_3\\
\boxed{a_3=\frac{mg}{2M+m}}
\end{align*}
\end{solution}
